% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_prep.R
\name{preprocess_enhancerMatrix}
\alias{preprocess_enhancerMatrix}
\title{Preprocess Enhancer Counts (GeneHancer-based + scenario-specific low-expression filters)}
\usage{
preprocess_enhancerMatrix(
  enhancer.counts,
  filter.low = FALSE,
  detect.rate = NULL,
  GeneHancer.file,
  GeneCode.file,
  meta_data = NULL,
  group.col = NULL,
  group = NULL,
  detect.count = 1L,
  min.samples = NULL,
  CPM_tMM = FALSE,
  ...
)
}
\arguments{
\item{enhancer.counts}{Numeric matrix of raw counts; rows = enhancers (GHid), cols = samples.}

\item{filter.low}{Logical; if TRUE apply the scenario-specific low-expression filter (default FALSE).}

\item{detect.rate}{Numeric in (0,1); required for the ungrouped filter. Represents the minimum fraction
of samples that must reach \code{detect.count} reads.}

\item{GeneHancer.file}{Path to GeneHancer annotation file.}

\item{GeneCode.file}{Path to GTF file with gene annotations.}

\item{meta_data}{Optional data.frame with sample-level metadata (rownames must match column names of
\code{enhancer.counts}).}

\item{group.col}{Character scalar naming the column in \code{meta_data} that encodes group membership
for pairwise designs. Ignored if \code{group} is supplied.}

\item{group}{Optional factor/character vector of group labels aligned to the columns of
\code{enhancer.counts}. Overrides \code{group.col} if provided.}

\item{detect.count}{Integer threshold of raw counts used for the detect-rate filter in the ungrouped
scenario. Defaults to 1.}

\item{min.samples}{Optional integer with the minimum number of samples that must pass \code{detect.count}
when using the detect-rate filter. If NULL, it is derived from \code{detect.rate}.}

\item{CPM_tMM}{Logical; if TRUE, compute and return TMM-normalized CPM (non-log) alongside the filtered
counts.}

\item{...}{Optional arguments. The legacy argument name \code{enhancer.matrix} is accepted via \code{...}
for backward compatibility.}
}
\value{
If \code{CPM_tMM = TRUE}, a list with elements \code{counts} (filtered counts) and \code{cpm_tmm}
  (TMM-normalized CPM matrix). Otherwise, returns the filtered counts matrix.
}
\description{
Keeps only enhancers present in GeneHancer after removing promoters and exon overlaps,
then applies a low-expression filter tailored to either (i) pairwise designs with group labels
or (ii) collections without group information. Optionally returns TMM-normalized CPM values
using edgeR.
}
